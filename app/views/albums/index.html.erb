<%= render "shared/navSidebar" %>
<div class="border-b">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between px-4 ">
      <h1 class="font-semibold text-4xl py-4 sm:ml-64">
        Dashboard
      </h1>

      <!-- Search -->
      <div class="w-full mt-2 sm:mt-0 sm:ml-auto sm:mr-6 sm:w-96">
        <%= form_with url: albums_path, method: :get, local: true do %>
          <div class="flex gap-2">
            <%= text_field_tag :query,
              nil,
              placeholder: "Search",
              autocomplete: "off",
              class: "w-full px-4 py-2 rounded-lg
                   bg-white/10 placeholder-gray-400
                   border border-white/10
                   focus:outline-none focus:ring-2 focus:ring-indigo-500" %>

            <%= submit_tag "Search",
              class: "px-4 py-2 rounded-lg bg-indigo-600 text-white font-medium
                   hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
          </div>
        <% end %>
      </div>

  </div>
</div>


<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-5 mx-6 p-3 sm:ml-64 mt-14">
  <% @albums.each do |album| %>
    <div class="bg-neutral-primary-soft block max-w-sm p-6 border border-default rounded-base shadow-xs relative">

     <!-- Three dots menu -->
      <div class="absolute top-3 right-3">
        <button
          type="button"
          class="album-menu-btn w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-200 border border-gray-200"
        >
          <!-- three dots icon -->
          <svg class="w-5 h-5 text-gray-700" viewBox="0 0 24 24" fill="currentColor">
            <circle cy="5" cx="12" r="2" />
            <circle cy="12" cx="12" r="2" />
            <circle cy="19" cx="12" r="2" />
          </svg>
        </button>

        <!-- Dropdown -->
        <div class="album-menu hidden absolute right-0 mt-2 w-32 bg-white border border-gray-200 rounded shadow-lg z-50">
          <ul class="py-1 text-sm">
            <li>
              <%= link_to edit_album_path(album),
                class: "block px-4 py-2 hover:bg-gray-100" do %>
                Edit
              <% end %>
            </li>

            <li>
              <%= button_to album_path(album),
                method: :delete,
                data: { turbo_confirm: "Are you sure?" },
                class: "block w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100 bg-transparent border-none cursor-pointer" do %>
                Delete
              <% end %>
            </li>
          </ul>
        </div>
        </div>

      <!-- Album Cover Image -->
      <% first_photo_with_image = album.photos.find { |photo| photo.images.attached? } %>
      <% if first_photo_with_image %>
        <%= image_tag first_photo_with_image.images.first, class: "rounded-base w-full h-48 object-cover" %>
      <% else %>
          <div class="w-full h-48 bg-gray-200 rounded-base flex items-center justify-center text-gray-500">
             No Image
          </div>
      <% end %>
      
      <!-- Album Title -->
        <h5 class="mt-6 mb-2 text-2xl text-blue-900 font-semibold tracking-tight text-heading">
          <%= album.title %>
        </h5>

      <!-- Album Description -->
      <p class="mb-6 text-body text-blue-900">
        <%= truncate(album.description, length: 100) %>
      </p>
      
      <!-- Tags -->
      <% if album.tags.any? %>
        <div class="mt-3 flex flex-wrap gap-2">
           <% album.tags.each do |tag|%>
              <span class="bg-gray-500 text-white text-xs px-3 py-1 rounded-full">
                <%= tag.name %>
              </span>
            <% end %>
        </div>
      <% end %>

      <!-- View Album Button -->
      <%= link_to album_photos_path(album),class: "mt-4 inline-flex items-center text-body bg-neutral-secondary-medium box-border border border-default-medium hover:bg-neutral-tertiary-medium hover:text-heading focus:ring-4 focus:ring-neutral-tertiary shadow-xs font-medium leading-5 rounded-base text-sm px-4 py-2.5 rounded focus:outline-none hover:bg-blue-500 hover:text-white" do %>
        View Album
        <svg class="w-4 h-4 ms-1.5 rtl:rotate-180 -me-0.5"
             xmlns="http://www.w3.org/2000/svg"
             fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round"
                stroke-linejoin="round" stroke-width="2"
                d="M19 12H5m14 0-4 4m4-4-4-4" />
        </svg>
      <% end %>
    </div>
  <% end %>
 </div>
